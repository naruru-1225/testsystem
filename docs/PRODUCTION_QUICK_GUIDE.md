# æœ¬ç•ªç’°å¢ƒãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - å®Œå…¨å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## ğŸ“‹ å‰ææ¡ä»¶

- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢ã—ãŸ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ãŸ
- [ ] ã™ã¹ã¦ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ãŸ

---

## ğŸš€ å®Ÿè¡Œæ‰‹é †(ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆç”¨)

### ã‚¹ãƒ†ãƒƒãƒ— 0: ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

```powershell
cd C:\Users\ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼\Desktop\testproject
```

### ã‚¹ãƒ†ãƒƒãƒ— 1: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª

```powershell
node check-migration-status.mjs
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**: æ¬¡ã«å®Ÿè¡Œã™ã¹ãã‚¹ãƒ†ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™

---

### ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ(ã¾ã ã®å ´åˆ)

```powershell
Copy-Item -Path "data" -Destination "data_backup_$(Get-Date -Format 'yyyyMMdd_HHmmss')" -Recurse
```

**ç¢ºèª**: `data_backup_YYYYMMDD_HHMMSS` ãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª

---

### ã‚¹ãƒ†ãƒƒãƒ— 3: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

#### æ–¹æ³• A: ä¸€æ‹¬å®Ÿè¡Œ(æ¨å¥¨)

```powershell
node run-all-migrations.mjs
```

**ã“ã®æ–¹æ³•ã®åˆ©ç‚¹**:

- ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è‡ªå‹•å®Ÿè¡Œ
- ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°è‡ªå‹•åœæ­¢
- ã©ã“ã¾ã§å®Œäº†ã—ãŸã‹è¡¨ç¤º

---

#### æ–¹æ³• B: å€‹åˆ¥å®Ÿè¡Œ(ãƒˆãƒ©ãƒ–ãƒ«æ™‚)

```powershell
# ã‚¹ãƒ†ãƒƒãƒ—1
node migrate-folder-unique-constraint.mjs
```

**å‡ºåŠ›ä¾‹**:

```
âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†!
ç§»è¡Œã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€æ•°: XXä»¶
âœ… å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒæ­£ã—ãä¿®æ­£ã•ã‚Œã¾ã—ãŸ!
   UNIQUE(name, parent_id)
```

æˆåŠŸã—ãŸã‚‰æ¬¡ã¸:

```powershell
# ã‚¹ãƒ†ãƒƒãƒ—2
node fix-tests-foreign-key.mjs
```

**å‡ºåŠ›ä¾‹**:

```
âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†!
ç§»è¡Œã•ã‚ŒãŸãƒ†ã‚¹ãƒˆæ•°: XXä»¶
âœ… å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ãŒæ­£ã—ãä¿®æ­£ã•ã‚Œã¾ã—ãŸ!
   FOREIGN KEY (folder_id) REFERENCES folders
```

æˆåŠŸã—ãŸã‚‰æ¬¡ã¸:

```powershell
# ã‚¹ãƒ†ãƒƒãƒ—3
node fix-test-folders-foreign-key.mjs
```

æˆåŠŸã—ãŸã‚‰æ¬¡ã¸:

```powershell
# ã‚¹ãƒ†ãƒƒãƒ—4
node fix-test-tags-foreign-key.mjs
```

æˆåŠŸã—ãŸã‚‰æ¬¡ã¸:

```powershell
# ã‚¹ãƒ†ãƒƒãƒ—5
node fix-test-attachments-foreign-key.mjs
```

---

### ã‚¹ãƒ†ãƒƒãƒ— 4: æ¤œè¨¼

```powershell
node verify-migration.mjs
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
==================================================
[ãƒ†ã‚¹ãƒˆ1] folders_oldã¸ã®å‚ç…§ãƒã‚§ãƒƒã‚¯
  âœ… å¤ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ãªã—
[ãƒ†ã‚¹ãƒˆ2] foldersãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ¶ç´„ç¢ºèª
  âœ… UNIQUE(name, parent_id)åˆ¶ç´„ã‚ã‚Š
[ãƒ†ã‚¹ãƒˆ3] testsãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ç¢ºèª
  âœ… testsãƒ†ãƒ¼ãƒ–ãƒ«: FOREIGN KEY â†’ folders
[ãƒ†ã‚¹ãƒˆ4] test_foldersãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ç¢ºèª
  âœ… test_foldersãƒ†ãƒ¼ãƒ–ãƒ«: FOREIGN KEY â†’ tests, folders
[ãƒ†ã‚¹ãƒˆ5] æœªåˆ†é¡ãƒ•ã‚©ãƒ«ãƒ€ã®ç¢ºèª
  âœ… æœªåˆ†é¡ãƒ•ã‚©ãƒ«ãƒ€å­˜åœ¨ (ID: X)
[ãƒ†ã‚¹ãƒˆ6] åŒåãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆãƒ†ã‚¹ãƒˆ
  âœ… ç•°ãªã‚‹è¦ªã§ã®åŒåãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ: æˆåŠŸ
  âœ… åŒã˜è¦ªã§ã®åŒåãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ: æ­£ã—ãã‚¨ãƒ©ãƒ¼
==================================================
ğŸ‰ ã™ã¹ã¦ã®æ¤œè¨¼ã«åˆæ ¼ã—ã¾ã—ãŸ!
```

ã™ã¹ã¦ âœ… ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™!

---

### ã‚¹ãƒ†ãƒƒãƒ— 5: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

```powershell
npm run dev
```

---

## âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ

### ã‚¨ãƒ©ãƒ¼ 1: "Cannot find module"

**åŸå› **: ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«åã®ã‚¹ãƒšãƒ«ãƒŸã‚¹

**è§£æ±º**:

```powershell
# ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ã‚’ç¢ºèª
Get-ChildItem -Filter "*.mjs" | Select-Object Name
```

å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆã¯ã€é–‹ç™ºç’°å¢ƒã‹ã‚‰ã‚³ãƒ”ãƒ¼

---

### ã‚¨ãƒ©ãƒ¼ 2: "no such table: main.folders_old"

**åŸå› **: ã‚¹ãƒ†ãƒƒãƒ— 1 ã‚’å®Ÿè¡Œã›ãšã«ã‚¹ãƒ†ãƒƒãƒ— 2 ä»¥é™ã‚’å®Ÿè¡Œã—ãŸ

**è§£æ±º**:

```powershell
# ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
node check-migration-status.mjs

# ã‚¹ãƒ†ãƒƒãƒ—1ã‹ã‚‰å®Ÿè¡Œ
node migrate-folder-unique-constraint.mjs
```

---

### ã‚¨ãƒ©ãƒ¼ 3: "UNIQUE constraint failed"

**åŸå› **: ã™ã§ã«åŒåã®ãƒ•ã‚©ãƒ«ãƒ€ãŒå­˜åœ¨ã™ã‚‹

**ã“ã‚Œã¯æ­£å¸¸ãªå‹•ä½œã§ã™** - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã¯æˆåŠŸã—ã¦ã„ã¾ã™

---

### ã‚¨ãƒ©ãƒ¼ 4: ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ‰‹é †**:

1. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼**

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¾©å…ƒ**:

```powershell
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢(Ctrl+C)

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å¾©å…ƒ
Remove-Item data\tests.db
Copy-Item data_backup_YYYYMMDD_HHMMSS\tests.db data\tests.db
```

3. **çŠ¶æ…‹ã‚’ç¢ºèª**:

```powershell
node check-migration-status.mjs
```

4. **å†åº¦å®Ÿè¡Œ**

---

## ğŸ¯ ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### å®Œå…¨å®Ÿè¡Œ(æœ€åˆã‹ã‚‰)

```powershell
cd C:\Users\ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼\Desktop\testproject
node check-migration-status.mjs
node run-all-migrations.mjs
node verify-migration.mjs
npm run dev
```

### å€‹åˆ¥å®Ÿè¡Œ(ãƒˆãƒ©ãƒ–ãƒ«æ™‚)

```powershell
cd C:\Users\ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼\Desktop\testproject
node migrate-folder-unique-constraint.mjs
node fix-tests-foreign-key.mjs
node fix-test-folders-foreign-key.mjs
node fix-test-tags-foreign-key.mjs
node fix-test-attachments-foreign-key.mjs
node verify-migration.mjs
npm run dev
```

### å¾©å…ƒ(ã‚¨ãƒ©ãƒ¼æ™‚)

```powershell
cd C:\Users\ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼\Desktop\testproject
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åœæ­¢(Ctrl+C)
Remove-Item data\tests.db
Copy-Item data_backup_YYYYMMDD_HHMMSS\tests.db data\tests.db
npm run dev
```

---

## âœ… æˆåŠŸç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `node check-migration-status.mjs` - ã€Œã™ã¹ã¦å®Œäº†ã€ã¨è¡¨ç¤º
- [ ] `node verify-migration.mjs` - ã™ã¹ã¦ âœ… ãŒè¡¨ç¤º
- [ ] `npm run dev` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ - æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ - ç•°ãªã‚‹è¦ªã§åŒåãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã§ãã‚‹
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ - ã‚¨ãƒ©ãƒ¼ãªãä½œæˆã§ãã‚‹

---

**ğŸ‰ ã™ã¹ã¦å®Œäº†ã—ãŸã‚‰ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸã§ã™!**
