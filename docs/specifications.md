# テスト管理システム 仕様書

## システム概要

### 目的

塾内でのテスト作成、管理、検索を効率化する Web アプリケーション

### 対象ユーザー

- 塾の講師
- 塾の管理者

### 利用環境

- **ネットワーク**: イーサネット(ローカルネットワーク)限定
- **デバイス**: タブレット(主)、PC(副)
- **ブラウザ**: Chrome, Safari, Edge, Firefox (最新版推奨)

---

## 技術仕様

### フロントエンド

| 項目           | 技術         | バージョン |
| -------------- | ------------ | ---------- |
| フレームワーク | Next.js      | 15.5.6     |
| UI ライブラリ  | React        | 19.0.0     |
| 言語           | TypeScript   | 5.x        |
| スタイリング   | Tailwind CSS | 3.4.1      |

### バックエンド

| 項目          | 技術           | バージョン |
| ------------- | -------------- | ---------- |
| ランタイム    | Node.js        | 18.17 以上 |
| データベース  | SQLite         | -          |
| DB ライブラリ | better-sqlite3 | 11.7.0     |

### アーキテクチャ

```
┌─────────────────────────────────────────┐
│         ブラウザ (クライアント)           │
│  ┌───────────────────────────────────┐  │
│  │  React Components                 │  │
│  │  - TestList                       │  │
│  │  - Sidebar                        │  │
│  └───────────────────────────────────┘  │
└─────────────────┬───────────────────────┘
                  │ HTTP/HTTPS
                  │
┌─────────────────▼───────────────────────┐
│         Next.js Server                  │
│  ┌───────────────────────────────────┐  │
│  │  API Routes                       │  │
│  │  - /api/tests                     │  │
│  │  - /api/folders                   │  │
│  │  - /api/tags                      │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │  Database Layer                   │  │
│  │  - SQLite (better-sqlite3)        │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
                  │
                  ▼
          ┌─────────────┐
          │  tests.db   │
          └─────────────┘
```

---

## データベース仕様

### ER 図

```
┌──────────────┐         ┌──────────────┐
│   folders    │         │     tags     │
├──────────────┤         ├──────────────┤
│ id (PK)      │         │ id (PK)      │
│ name         │         │ name         │
│ created_at   │         │ color        │
└──────┬───────┘         └──────┬───────┘
       │                        │
       │ 1:N                    │ N:M
       │                        │
┌──────▼───────┐         ┌──────▼───────┐
│    tests     │◄────────┤  test_tags   │
├──────────────┤   N:M   ├──────────────┤
│ id (PK)      │         │ id (PK)      │
│ name         │         │ test_id (FK) │
│ subject      │         │ tag_id (FK)  │
│ grade        │         └──────────────┘
│ folder_id(FK)│
│ created_at   │
│ updated_at   │
└──────────────┘
```

### テーブル定義

#### folders テーブル

| カラム名   | 型       | 制約                       | 説明        |
| ---------- | -------- | -------------------------- | ----------- |
| id         | INTEGER  | PRIMARY KEY, AUTOINCREMENT | フォルダ ID |
| name       | TEXT     | NOT NULL, UNIQUE           | フォルダ名  |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP  | 作成日時    |

**インデックス**: なし

#### tests テーブル

| カラム名   | 型       | 制約                       | 説明        |
| ---------- | -------- | -------------------------- | ----------- |
| id         | INTEGER  | PRIMARY KEY, AUTOINCREMENT | テスト ID   |
| name       | TEXT     | NOT NULL                   | テスト名    |
| subject    | TEXT     | NOT NULL                   | 科目        |
| grade      | TEXT     | NOT NULL                   | 学年        |
| folder_id  | INTEGER  | NOT NULL, FOREIGN KEY      | フォルダ ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP  | 作成日時    |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP  | 更新日時    |

**インデックス**:

- `idx_tests_folder_id` (folder_id)
- `idx_tests_subject` (subject)
- `idx_tests_grade` (grade)

#### tags テーブル

| カラム名 | 型      | 制約                        | 説明              |
| -------- | ------- | --------------------------- | ----------------- |
| id       | INTEGER | PRIMARY KEY, AUTOINCREMENT  | タグ ID           |
| name     | TEXT    | NOT NULL, UNIQUE            | タグ名            |
| color    | TEXT    | NOT NULL, DEFAULT '#3B82F6' | タグの色(16 進数) |

**インデックス**: なし

#### test_tags テーブル

| カラム名 | 型      | 制約                       | 説明      |
| -------- | ------- | -------------------------- | --------- |
| id       | INTEGER | PRIMARY KEY, AUTOINCREMENT | ID        |
| test_id  | INTEGER | NOT NULL, FOREIGN KEY      | テスト ID |
| tag_id   | INTEGER | NOT NULL, FOREIGN KEY      | タグ ID   |

**制約**:

- UNIQUE(test_id, tag_id) - 同じテストに同じタグを複数付けられない

**インデックス**:

- `idx_test_tags_test_id` (test_id)
- `idx_test_tags_tag_id` (tag_id)

---

## API 仕様

### 共通仕様

- **プロトコル**: HTTP/HTTPS
- **データ形式**: JSON
- **文字コード**: UTF-8
- **エラーレスポンス形式**:
  ```json
  {
    "error": "エラーメッセージ"
  }
  ```

### エンドポイント一覧

#### 1. テスト一覧取得

**エンドポイント**: `GET /api/tests`

**クエリパラメータ**:
| パラメータ名 | 型 | 必須 | 説明 |
|------------|-----|------|------|
| folderId | number | No | フォルダ ID でフィルタ |
| search | string | No | 検索キーワード(テスト名、科目、学年) |

**レスポンス例**:

```json
[
  {
    "id": 1,
    "name": "2023年度 1学期期末テスト",
    "subject": "数学",
    "grade": "中3",
    "folder_id": 2,
    "folder_name": "中3数学",
    "created_at": "2025-06-20 10:00:00",
    "updated_at": "2025-06-20 10:00:00",
    "tags": [
      {
        "id": 1,
        "name": "方程式",
        "color": "#3B82F6"
      }
    ]
  }
]
```

**ステータスコード**:

- 200: 成功
- 500: サーバーエラー

#### 2. テスト新規作成

**エンドポイント**: `POST /api/tests`

**リクエストボディ**:

```json
{
  "name": "テスト名",
  "subject": "科目",
  "grade": "学年",
  "folderId": 1,
  "tagIds": [1, 2]
}
```

**レスポンス例**:

```json
{
  "id": 7,
  "name": "テスト名",
  "subject": "科目",
  "grade": "学年",
  "folder_id": 1,
  "folder_name": "フォルダ名",
  "created_at": "2025-10-28 10:00:00",
  "updated_at": "2025-10-28 10:00:00",
  "tags": [
    {
      "id": 1,
      "name": "タグ名",
      "color": "#3B82F6"
    }
  ]
}
```

**ステータスコード**:

- 201: 作成成功
- 400: バリデーションエラー
- 500: サーバーエラー

#### 3. フォルダ一覧取得

**エンドポイント**: `GET /api/folders`

**レスポンス例**:

```json
[
  {
    "id": 1,
    "name": "すべてのテスト",
    "created_at": "2025-10-28 10:00:00"
  }
]
```

**ステータスコード**:

- 200: 成功
- 500: サーバーエラー

#### 4. フォルダ新規作成

**エンドポイント**: `POST /api/folders`

**リクエストボディ**:

```json
{
  "name": "フォルダ名"
}
```

**レスポンス例**:

```json
{
  "id": 5,
  "name": "フォルダ名",
  "created_at": "2025-10-28 10:00:00"
}
```

**ステータスコード**:

- 201: 作成成功
- 400: バリデーションエラー(重複など)
- 500: サーバーエラー

#### 5. タグ一覧取得

**エンドポイント**: `GET /api/tags`

**レスポンス例**:

```json
[
  {
    "id": 1,
    "name": "方程式",
    "color": "#3B82F6"
  }
]
```

**ステータスコード**:

- 200: 成功
- 500: サーバーエラー

---

## 画面仕様

### 1. トップ画面(テスト一覧)

**パス**: `/`

**構成要素**:

1. **サイドバー**(左側、PC/タブレット横向き時のみ表示)

   - システム名
   - フォルダ一覧
   - 管理者メニュー

2. **メインエリア**
   - 検索バー
   - 新規テスト登録ボタン
   - テスト一覧テーブル

**テーブル列**:
| 列名 | 説明 | ソート | フィルタ |
|------|------|--------|---------|
| テスト名 | テストの名称 | - | 検索可能 |
| 科目 | 科目名 | - | 検索可能 |
| 学年 | 学年 | - | 検索可能 |
| ラベル | タグの一覧 | - | - |
| 登録日 | 作成日時 | - | - |
| 操作 | 編集/印刷ボタン | - | - |

**機能**:

- フォルダクリックでフィルタリング
- 検索バーでリアルタイム検索
- レスポンシブレイアウト

**レスポンシブ対応**:

- **PC** (1024px 以上): サイドバー固定表示
- **タブレット横** (768px 以上): サイドバー固定表示
- **タブレット縦/スマホ** (768px 未満): サイドバー非表示

---

## 今後実装予定の画面

### 2. テスト登録画面

**パス**: `/tests/new`

**入力項目**:

- テスト名(必須)
- 科目(必須)
- 学年(必須)
- フォルダ選択(必須)
- タグ選択(複数可)

### 3. テスト編集画面

**パス**: `/tests/[id]/edit`

**機能**: テスト情報の変更

### 4. テストプレビュー/詳細画面

**パス**: `/tests/[id]`

**機能**: テスト情報の詳細表示

### 5. テスト削除確認画面

**機能**: モーダルまたは専用ページで削除確認

### 6. フォルダ管理画面

**パス**: `/folders`

**機能**: フォルダの作成、編集、削除

### 7. テスト印刷画面

**パス**: `/tests/[id]/print`

**機能**: 印刷用レイアウトでの表示

---

## UX 設計

### タブレット最適化

1. **タッチ操作対応**

   - ボタンの最小サイズ: 44×44px
   - タップハイライトの無効化
   - スワイプジェスチャー対応(今後)

2. **視認性**

   - フォントサイズ: 最小 14px
   - コントラスト比: WCAG AA 基準準拠
   - 十分な余白とパディング

3. **レスポンス性**
   - ローディング表示
   - 即座のフィードバック
   - デバウンス処理(検索)

### アクセシビリティ

- セマンティック HTML 使用
- キーボード操作対応
- ARIA ラベル(今後)

---

## セキュリティ

### 現在の実装

- SQL インジェクション対策: Prepared Statement 使用
- データベース: ローカルファイルシステム
- ネットワーク: ローカルネットワーク限定

### 今後の実装推奨

- ユーザー認証
- アクセス権限管理
- HTTPS 対応
- CSRF 対策
- XSS 対策

---

## パフォーマンス

### 最適化項目

1. **データベース**

   - インデックスの活用
   - クエリの最適化

2. **フロントエンド**

   - サーバーコンポーネントの活用
   - 検索のデバウンス(300ms)
   - 必要最小限のクライアントサイド JS

3. **ネットワーク**
   - ローカルネットワーク使用
   - レスポンスのキャッシュ(ブラウザ)

### パフォーマンス目標

| 指標           | 目標値     |
| -------------- | ---------- |
| 初期表示       | 2 秒以内   |
| API レスポンス | 100ms 以内 |
| 検索レスポンス | 300ms 以内 |

---

## 制限事項

### 現在のバージョン(最小規模)

- テスト登録は未実装(API は実装済み)
- テスト編集機能は未実装
- テスト削除機能は未実装
- フォルダ管理画面は未実装
- 印刷機能は未実装
- ユーザー認証機能なし
- 画像アップロード機能なし

### 技術的制限

- 同時接続数: 推奨 50 以下
- データベースサイズ: 推奨 1GB 以下
- SQLite: 単一書き込みプロセス

---

## ブラウザ対応

| ブラウザ | バージョン   | 対応状況 |
| -------- | ------------ | -------- |
| Chrome   | 最新版       | ◎        |
| Safari   | 最新版       | ◎        |
| Edge     | 最新版       | ◎        |
| Firefox  | 最新版       | ◎        |
| IE       | 全バージョン | ×        |

---

## 保守・運用

### バックアップ

**推奨頻度**: 週 1 回

**対象ファイル**:

- `data/tests.db`

**方法**:

```powershell
Copy-Item -Path "data" -Destination "backup\data_$(Get-Date -Format 'yyyyMMdd')" -Recurse
```

### ログ

**サーバーログ**: 標準出力(PowerShell)
**エラーログ**: 標準エラー出力

### 更新

**依存パッケージ**: 月 1 回

```powershell
npm update
```

---

## 用語集

| 用語     | 説明                       |
| -------- | -------------------------- |
| テスト   | 塾で使用する問題用紙       |
| フォルダ | テストを分類するカテゴリ   |
| タグ     | テストに付ける複数のラベル |
| 科目     | 数学、英語、国語など       |
| 学年     | 中 1、中 2、中 3 など      |

---

## 変更履歴

| 日付       | バージョン | 変更内容           |
| ---------- | ---------- | ------------------ |
| 2025-10-28 | 0.1.0      | 初版作成(最小規模) |

---

## 付録

### 初期データ

**フォルダ**:

1. すべてのテスト
2. 中 3 数学
3. 中 3 英語
4. 中 2 国語

**タグ**:

1. 方程式 (#3B82F6)
2. 四則 (#10B981)
3. 応用課題 (#EF4444)
4. 民主政治 (#8B5CF6)
5. 令和年度 (#F59E0B)
6. 本文読解 (#EC4899)
7. 平方完成 (#6366F1)
8. 二次関数 (#14B8A6)

**サンプルテスト**: 6 件
