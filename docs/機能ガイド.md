# テスト管理システム 機能ガイド

> このドキュメントはシステムの全機能と使い方をまとめたリファレンスです。  
> iPad・PCブラウザどちらからでも同様に利用できます。

---

## 📋 目次

1. [テスト一覧画面](#1-テスト一覧画面)
2. [テスト登録フォーム](#2-テスト登録フォーム)
3. [テスト編集フォーム](#3-テスト編集フォーム)
4. [PDFビューワー](#4-pdfビューワー)
5. [サイドバー・フォルダ管理](#5-サイドバーフォルダ管理)
6. [受信トレイ（メール取り込み）](#6-受信トレイメール取り込み)
7. [ダッシュボード](#7-ダッシュボード)
8. [管理画面](#8-管理画面)
9. [UI/UX全般](#9-uiux全般)

---

## 1. テスト一覧画面

### 1-1. 表示モード切替

| 操作 | 説明 |
|------|------|
| リストボタン | テーブル形式で表示（デフォルト） |
| カードボタン | グリッドカード形式で表示 |

### 1-2. 標準表示に戻す

表示設定（表示件数・並び順・行高・表示モード・列表示）を変更すると、ツールバーに「**標準表示に戻す**」ボタンが表示されます。  
クリックすると以下を一括リセットします：
- 並び順 → 新着順
- 表示モード → リスト
- 行の高さ → 標準
- 表示件数 → 25件
- 表示列 → 全列表示
- 列幅 → デフォルト幅

> ※ 設定はデバイスごとのブラウザローカルストレージに保存されるため、他の端末の表示設定に影響しません。

### 1-3. 並び替え

- カラムヘッダーをクリックするとその列で昇順/降順ソートが切り替わります
- ツールバーのドロップダウンから「新しい順」「古い順」なども選べます

### 1-4. 表示件数切替

ツールバーのセレクトボックスで 10 / 25 / 50 / 100 / 全件 を選択できます。

### 1-5. ページネーション

一覧下部のページネーションバーでページを切り替えられます。ブラウザの「戻る」ボタンでも前ページに戻れます。

### 1-6. 行の高さ調整

ツールバーの「コンパクト / 標準 / 広め」ボタンで行間を変更できます。

### 1-7. 列のカスタマイズ

「列」ボタンをクリックするとドロップダウンが表示され、各列の表示/非表示を切り替えられます。  
設定はデバイスのローカルストレージに保存されます。

### 1-8. 列幅リサイズ

リスト表示のカラムヘッダー右端にあるリサイズハンドルをドラッグして列幅を調整できます。幅はローカルストレージに保存されます。

### 1-9. 検索・フィルタ

| 機能 | 説明 |
|------|------|
| テキスト検索 | テスト名・メモ・タグをリアルタイム検索。ヒット部分がハイライト表示されます |
| 詳細検索 | 登録日範囲・大問数範囲でフィルタリング |
| タグフィルタ | 複数タグの AND / OR 条件でフィルタ |
| フォルダフィルタ | サイドバーのフォルダをクリックして絞り込み |
| 検索履歴 | 過去の検索ワードがドロップダウンに表示されます |

#### フィルタプリセット保存

よく使うフィルタ設定（科目・学年・タグ・日付範囲など）を名前をつけて保存できます。  
ツールバーの「フィルタ保存」ボタンから操作します。

### 1-10. 複数選択・一括操作

| 操作 | 方法 |
|------|------|
| 個別選択 | 各行の左端チェックボックスをON |
| 全選択 | ヘッダーチェックボックスをON |
| 一括削除 | 選択後「削除」ボタン（8秒間Undoが可能） |
| 一括フォルダ移動 | 選択後「フォルダ移動」でフォルダを選択 |
| 一括学年・科目変更 | 選択後「編集」→学年・科目を選択 |
| 一括タグ付け | 選択後「タグ」ボタンでタグを選択 |
| 一括印刷 | 選択後「印刷」ボタン |
| ZIP一括ダウンロード | 選択後「ZIPダウンロード」 |

### 1-11. ドラッグ&ドロップでフォルダ移動

テスト行をドラッグして、サイドバーのフォルダにドロップすることでフォルダを変更できます。

### 1-12. テストの複製

各行の「…」メニューから「複製」を選択するとテストをコピーします。

### 1-13. 削除のUndo

削除直後に画面下部にUndoトーストが8秒間表示されます。その間に「元に戻す」を押すと削除を取り消せます。

### 1-14. QRコード生成

テスト行の「…」メニューから「QRコード」を選択すると、そのテストへのリンクQRコードを生成・ダウンロードできます。

### 1-15. 関連テスト

テスト行の「…」メニューから「関連テスト」でテスト同士をリンクできます。

### 1-16. コメント機能

テスト行の「…」メニューから「コメント」でテストにコメントを追加できます。

### 1-17. 変更履歴

テスト行の「…」メニューから「変更履歴」で登録・編集・削除の操作ログを確認できます。

### 1-18. メモのMarkdown表示

テスト一覧のメモ列において`**太字**`や`- リスト`などのMarkdown記法が利用できます。

### 1-19. キーボードナビゲーション

- `Tab` でテスト行にフォーカス移動
- `Enter` でPDFを開く
- `←` / `→` でPDFビューワーのページ送り（ビューワー内）

---

## 2. テスト登録フォーム

### 2-1. 基本入力

| フィールド | 説明 |
|-----------|------|
| テスト名 | 必須。最大100文字 |
| 科目 | 必須。管理画面で追加可能 |
| 学年 | 必須。管理画面で追加可能 |
| メモ | 任意。Markdown書式使用可 |
| 大問数 | 任意。数値 |

### 2-2. バリデーション

入力不足・形式エラーがある場合、各フィールド直下に赤いエラーメッセージが表示されます。

### 2-3. 自動保存（下書き）

入力中のデータは自動的にブラウザのローカルストレージに保存されます。  
ページをリロードしても入力内容が復元されます。

### 2-4. 前回値の引継ぎ

「前回の値を引き継ぐ」ボタンを押すと、前回登録したテストの科目・学年・フォルダ・タグをそのままセットできます。

### 2-5. テンプレート

よく使う設定を「テンプレートとして保存」し、次回以降「テンプレートから読み込む」で一括セットできます。

### 2-6. メインPDFのアップロード

- **ドラッグ&ドロップ**またはクリックでファイルを選択
- 対応形式: PDF / HEIC / JPG / PNG（HEIC は自動でJPEGに変換）
- 複数のPDFファイルをドロップすると「**複数PDF一括作成**」モーダルが開き、1回の操作で複数テストを登録できます

#### 受信トレイから選択（新機能）

メインPDF欄の下にある「**受信トレイから選択**」ボタンをクリックすると、受信トレイに届いているPDFファイルの一覧が表示されます。  
ファイルを選択するとメインPDFとしてセットされます。

### 2-7. 添付ファイル

- メインPDF以外のPDF・画像・Word・Excelファイルを最大4つ添付できます
- 複数ファイルを同時選択してアップロード可能
- アップロード済みファイルはドラッグ&ドロップで並び替えできます
- 対応形式: PDF / HEIC / JPG / PNG / Word（doc, docx） / Excel（xls, xlsx）

#### 受信トレイから添付（新機能）

添付ファイル欄の「**受信トレイから選択**」ボタンで受信トレイのファイルを添付できます。  
複数ファイルを選択してまとめて追加することも可能です。

### 2-8. フォルダ・タグ設定

- 登録先フォルダを複数選択可能
- タグを複数付与可能

### 2-9. アップロード進捗バー

大きなファイルのアップロード中は進捗バーが表示されます。

---

## 3. テスト編集フォーム

テスト登録と同等の機能に加え、以下の機能があります。

### 3-1. 同時編集の競合防止

別の端末で同一テストを編集中の場合、保存時に「競合が発生しました」と通知されます。

### 3-2. 添付ファイルの管理

- 既存の添付ファイルは一覧表示
- 各ファイルの削除・並び替えが可能
- 「受信トレイから選択」で受信トレイのファイルを追加

---

## 4. PDFビューワー

テスト行（またはPDFリンク）をクリックするとPDFビューワーが開きます。

### 4-1. ナビゲーション

| 操作 | 説明 |
|------|------|
| ページ入力ボックス | ページ番号を直接入力してジャンプ |
| ←/→ キー | 前後ページ移動 |
| 連続スクロールモード | ページをスクロールで連続閲覧 |

### 4-2. サムネイル一覧

左サイドのサムネイルパネルでページを一覧表示し、クリックでジャンプできます。

### 4-3. ズーム・フィット

| モード | 説明 |
|--------|------|
| 幅に合わせる | 画面幅いっぱいに表示 |
| 全体表示 | ページ全体が見えるようにフィット |
| 自由ズーム | +/- ボタンまたはピンチ操作でズーム |

**iPadではピンチイン/アウトによるズームが使用できます。**

### 4-4. 回転

ページの向きが間違っている場合、回転ボタンで90°単位で回転できます。

### 4-5. PDF内テキスト検索

検索アイコンをクリックして検索ワードを入力すると、PDF内のテキストをハイライト検索できます。

### 4-6. ダークモード

ビューワー内の「ダークモード」ボタンで画面を暗色表示に切り替えます。

### 4-7. 印刷設定

歯車アイコンから印刷設定パネルを開けます。

| 設定項目 | 説明 |
|---------|------|
| ページ範囲 | 印刷するページを指定 |
| 部数 | 印刷枚数を指定 |
| 両面印刷 | 片面/両面を選択 |
| 用紙サイズ | A4/A5/Letter/カスタムサイズ |

### 4-8. キーボードショートカット（ビューワー内）

| キー | 動作 |
|------|------|
| `←` / `→` | ページ送り |
| `+` / `-` | ズームイン/アウト |
| `Esc` | ビューワーを閉じる |

---

## 5. サイドバー・フォルダ管理

### 5-1. フォルダ構造

- 階層構造（親子フォルダ）をサポート
- フォルダ横の件数バッジでテスト数を確認できます
- フォルダアイコンは管理画面からカスタマイズ可能

### 5-2. フォルダ操作

| 操作 | 方法 |
|------|------|
| 新規フォルダ作成 | 「+」ボタン |
| フォルダ名変更 | ダブルクリックまたは右クリックメニュー |
| フォルダ削除 | 右クリックメニューまたは「…」ボタン |
| フォルダ並び替え | 同階層内でドラッグ&ドロップ |
| フォルダ検索 | サイドバー上部の検索欄で絞り込み |

### 5-3. テスト数バッジ

各フォルダに収録されているテストの件数がバッジ表示されます。

---

## 6. 受信トレイ（メール取り込み）

左サイドバーの「受信トレイ」をクリックして開きます。メールで届いたPDFファイルが一覧表示されます。

### 6-1. 受信ファイルの確認

- 受信済みファイルが一覧表示されます
- 未処理ファイル数がサイドバーのバッジに表示されます

### 6-2. 一括テスト作成

「一括テスト作成」ボタンをクリックすると、受信ファイルから複数のテストをまとめて登録できます。

### 6-3. テスト登録画面からファイルを選択（新機能）

テスト登録・編集フォームの「**受信トレイから選択**」ボタンから、受信トレイに届いているファイルをメインPDFまたは添付ファイルとして直接設定できます。

**手順：**
1. テスト登録（または編集）フォームを開く
2. メインPDF欄または添付ファイル欄の「**受信トレイから選択**」ボタンをクリック
3. 受信トレイのファイル一覧が表示される
4. 目的のファイルをクリックして選択
5. 選択されたファイルがPDF/添付ファイルとしてセットされる

> ※ 複数ファイルを添付したい場合は、ボタンを複数回クリックして順番に選択してください。

### 6-4. エラー時の再試行

取り込みエラーが発生したファイルは「再試行」ボタンで再処理できます。

---

## 7. ダッシュボード

ナビゲーションの「ダッシュボード」または「/dashboard」で開きます。

### 7-1. 期間フィルタ

「過去7日」「過去30日」「過去90日」「全期間」などで表示期間を絞り込めます。

### 7-2. グラフ・統計

| ウィジェット | 内容 |
|------------|------|
| 登録推移グラフ | 期間内のテスト登録数の折れ線グラフ |
| 科目別カバー率 | 科目ごとのテスト登録数の割合 |
| ストレージ使用量 | アップロードファイルの合計容量 |
| 最近の活動 | 最近登録・変更されたテスト |

### 7-3. ウィジェットのカスタマイズ

ダッシュボード右上の設定アイコンから、表示するウィジェットの選択や並び替えができます。

### 7-4. CSVダウンロード

「CSVダウンロード」ボタンから、現在の集計データをCSV形式でダウンロードできます。

---

## 8. 管理画面

画面右上のギアアイコンから管理画面（AdminModal）を開きます。

### 8-1. 学年・科目の管理

- 学年・科目の追加・編集・削除
- ドラッグ&ドロップで並び替え
- 各マスタの使用件数を表示
- 使用中のマスタを削除する際は代替先を選択できます

### 8-2. 自動バックアップ設定

| 設定 | 説明 |
|------|------|
| バックアップ間隔 | 何日ごとにバックアップするかを設定 |
| 最大保存数 | 古いバックアップが自動削除される上限数 |

### 8-3. バックアップ履歴

過去のバックアップ一覧を表示します。バックアップを選択し「復元」ボタンで復元できます。

### 8-4. 差分復元

バックアップから特定のテストだけを選んで復元することができます。

### 8-5. フォルダアイコン設定

フォルダ一覧から各フォルダのアイコン（絵文字）を変更できます。

### 8-6. デモデータ作成

「デモデータ作成」ボタンで開発・動作確認用のサンプルtests/folders/tags/inbox filesを一括生成します。

> ※ 既存データがある場合は上書きされません。

### 8-7. アクセスログ

システムへのアクセス履歴（端末情報含む）を確認できます。

---

## 9. UI/UX全般

### 9-1. ダークモード

画面右上のテーマアイコンからダークモード・ライトモード・システム設定に合わせるを選択できます。

### 9-2. フォントサイズ調整

テーマアイコン横のボタンから「小」「中（デフォルト）」「大」のフォントサイズを選択できます。

### 9-3. トースト通知

操作の成功・エラーはページ右下にトースト通知として表示されます。

### 9-4. スケルトンローディング

データ読み込み中はプレースホルダー（スケルトン）が表示されます。

### 9-5. エラー時のリトライ

一覧読み込みに失敗した場合、「再読み込み」ボタンが表示されます。

### 9-6. 確認ダイアログ

削除などの重要操作は確認モーダルダイアログが表示されます。

### 9-7. レスポンシブ対応

iPad（横向き・縦向き）でも問題なく操作できるレイアウトとなっています。

---

## 📂 対応ファイル形式まとめ

| 用途 | 対応形式 |
|------|---------|
| メインPDF | PDF / HEIC / HEIF / JPG / JPEG / PNG |
| 添付ファイル | PDF / HEIC / HEIF / JPG / JPEG / PNG / Word (doc, docx) / Excel (xls, xlsx) |
| 最大ファイルサイズ | 各ファイル 10 MB |
| 最大添付数 | メインPDF + 添付4ファイル = 合計5ファイル |

---

## 🔑 主要キーボードショートカット

| 場所 | キー | 動作 |
|------|------|------|
| PDFビューワー | `←` / `→` | ページ送り |
| PDFビューワー | `+` / `-` | ズームイン/アウト |
| PDFビューワー | `Esc` | 閉じる |
| テスト一覧 | `Tab` | 行間を移動 |
| テスト一覧 | `Enter` | 選択行のPDFを開く |

---

## 🔒 セキュリティ・安全性

- アップロードファイルのマジックナンバー検証（ファイル偽装を防止）
- 入力値サニタイズ（XSS対策）
- 同時編集競合防止（409エラーで通知）
- 操作ログ記録（端末情報含む）

---

## 📊 エクスポート・連携

| 機能 | 説明 |
|------|------|
| PDF一括ZIPダウンロード | 選択したテストのPDFをZIPで一括ダウンロード |
| QRコード生成 | テストへのリンクQRコードをPNG形式でダウンロード |
| CSVダウンロード | ダッシュボードの統計データをCSVでエクスポート |

---

*最終更新: システム機能改善実装後*
