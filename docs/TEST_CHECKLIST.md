# テスト管理システム 包括的テストチェックリスト

実施日: ******\_******  
実施者: ******\_******

---

## 1. データベース構造テスト ✅

### 1.1 テーブル存在確認

- [ ] folders テーブルが存在する
- [ ] tests テーブルが存在する
- [ ] tags テーブルが存在する
- [ ] test_attachments テーブルが存在する
- [ ] grades テーブルが存在する
- [ ] subjects テーブルが存在する
- [ ] test_tags テーブルが存在する
- [ ] test_folders テーブルが存在する

### 1.2 カラム構造確認

- [ ] folders テーブルに order_index カラムが存在する
- [ ] tests テーブルに pdf_path カラムが存在する
- [ ] tests テーブルに description カラムが存在する
- [ ] tags テーブルに color カラムが存在する

---

## 2. フォルダ機能テスト 📁

### 2.1 基本機能

- [ ] デフォルトフォルダ「すべてのテスト」が表示される
- [ ] デフォルトフォルダ「未分類」が表示される
- [ ] フォルダ一覧が正しく表示される
- [ ] 新規フォルダが作成できる
- [ ] フォルダ名が編集できる
- [ ] フォルダが削除できる

### 2.2 ドラッグ&ドロップ機能 ⭐ 新機能

- [ ] フォルダを上にドラッグできる
- [ ] フォルダを下にドラッグできる
- [ ] ドラッグ中に視覚的フィードバックがある（透明度、背景色）
- [ ] ドラッグハンドル（6 点アイコン）が表示される
- [ ] 「すべてのテスト」フォルダはドラッグできない
- [ ] 「未分類」フォルダはドラッグできない
- [ ] ドラッグ後の順序がサーバーに保存される
- [ ] ページリロード後も順序が保持される
- [ ] サーバー再起動後も順序が保持される

**テスト手順:**

1. サイドバーでフォルダを選択
2. ドラッグハンドルを使ってフォルダを移動
3. ブラウザをリロード（Ctrl+R）
4. 順序が保持されているか確認
5. サーバーを再起動（`npm run dev`）
6. 再度順序が保持されているか確認

### 2.3 エラーハンドリング

- [ ] 重複フォルダ名のエラーメッセージが表示される
- [ ] フォルダ削除時の確認ダイアログが表示される
- [ ] ネットワークエラー時に適切なエラーメッセージが表示される

---

## 3. テスト機能テスト 📝

### 3.1 テスト作成

- [ ] 新規テスト作成ページが開く
- [ ] テスト名を入力できる
- [ ] 科目を選択できる
- [ ] 学年を選択できる
- [ ] フォルダを選択できる
- [ ] 複数フォルダを選択できる
- [ ] タグを選択できる
- [ ] 複数タグを選択できる
- [ ] PDF ファイルをアップロードできる
- [ ] 説明を入力できる
- [ ] 問題数を入力できる
- [ ] 満点を入力できる
- [ ] テストが正常に作成される

### 3.2 テスト一覧・検索

- [ ] テスト一覧が表示される
- [ ] フォルダでフィルタリングできる
- [ ] 科目でフィルタリングできる
- [ ] 学年でフィルタリングできる
- [ ] タグでフィルタリングできる
- [ ] キーワード検索ができる
- [ ] 複数条件での検索ができる

### 3.3 テスト編集・削除

- [ ] テスト詳細が表示される
- [ ] テスト情報が編集できる
- [ ] テストが削除できる
- [ ] 削除時の確認ダイアログが表示される

---

## 4. PDF 機能テスト 📄 ⭐ 重要

### 4.1 PDF プレビュー（メイン PDF）

- [ ] テストのメイン PDF がプレビューできる
- [ ] PDF が正しく表示される（白い画面にならない）
- [ ] ページ送りができる
- [ ] ページ戻しができる
- [ ] ズームイン・ズームアウトができる
- [ ] ページ番号が表示される
- [ ] 総ページ数が表示される

**確認項目:**

```
- URLが /api/pdf/pdfs/test_X/xxx.pdf 形式になっているか
- 開発者ツールでエラーが表示されていないか
- PDF.js workerが /pdfjs/pdf.worker.min.mjs から読み込まれているか
```

### 4.2 PDF プレビュー（添付ファイル）

- [ ] 添付ファイルタブが表示される
- [ ] 添付ファイル PDF がプレビューできる
- [ ] 複数の添付ファイルがある場合、タブ切り替えができる
- [ ] タブ切り替え時に PDF が正しく切り替わる
- [ ] タブ切り替え時に白い画面にならない

**タブ切り替えテスト手順:**

1. メイン PDF を表示
2. 添付ファイルタブをクリック
3. 添付ファイル PDF が表示されるか確認
4. メインタブに戻る
5. メイン PDF が再表示されるか確認
6. 複数回タブを切り替えて安定性を確認

### 4.3 PDF 印刷機能

- [ ] 印刷ボタンが表示される
- [ ] メイン PDF の印刷ダイアログが開く
- [ ] 添付ファイル PDF の印刷ダイアログが開く
- [ ] 印刷プレビューで PDF が正しく表示される
- [ ] 実際に印刷できる（または PDF 保存できる）

**印刷テスト手順:**

1. PDF プレビュー画面で印刷ボタンをクリック
2. 新しいタブが開くか確認
3. PDF が読み込まれるのを待つ
4. 印刷ダイアログが自動で開くか確認
5. プレビューで PDF が正しく表示されているか確認

### 4.4 PDF エラーハンドリング

- [ ] PDF ファイルが存在しない場合のエラーメッセージ
- [ ] 破損した PDF ファイルのエラーメッセージ
- [ ] ネットワークエラー時のエラーメッセージ
- [ ] 読み込み中のローディング表示

### 4.5 PDF クロス環境テスト ⭐ 重要

- [ ] localhost:3000 で PDF が表示される
- [ ] 同一ネットワーク内の別デバイスから PDF が表示される（例: 100.79.45.99:3000）
- [ ] スマートフォンから PDF が表示される
- [ ] タブレットから PDF が表示される

**他環境テスト手順:**

1. 同じネットワーク内の別のデバイスを用意
2. http://100.79.45.99:3000 にアクセス
3. テスト一覧を表示
4. テストの PDF プレビューを開く
5. PDF が正しく表示されるか確認
6. 印刷機能をテスト
7. 添付ファイルの PDF も確認

**確認すべきエラー（過去に発生）:**

- ❌ 404 Not Found - PDF ファイルが見つからない
- ❌ "Cannot read properties of null (reading 'sendWithPromise')" - Worker 読み込みエラー
- ❌ "Failed to fetch dynamically imported module" - CDN 読み込みエラー
- ✅ これらのエラーが発生しないこと

---

## 5. タグ機能テスト 🏷️

### 5.1 タグ管理

- [ ] タグ一覧が表示される
- [ ] 新規タグが作成できる
- [ ] タグ名を編集できる
- [ ] タグの色を変更できる
- [ ] タグを削除できる

### 5.2 タグフィルタリング

- [ ] タグでテストをフィルタリングできる
- [ ] 複数タグで AND 検索ができる
- [ ] タグの色が正しく表示される

---

## 6. 添付ファイル機能テスト 📎

### 6.1 添付ファイル追加

- [ ] テスト作成時に添付ファイルを追加できる
- [ ] テスト編集時に添付ファイルを追加できる
- [ ] 複数の添付ファイルを追加できる
- [ ] PDF ファイルのみアップロードできる

### 6.2 添付ファイル表示・削除

- [ ] 添付ファイル一覧が表示される
- [ ] 添付ファイルのプレビューができる
- [ ] 添付ファイルを削除できる

---

## 7. バックアップ機能テスト 💾

### 7.1 バックアップ作成

- [ ] 管理メニューが開く
- [ ] バックアップ作成ボタンが表示される
- [ ] バックアップが作成される
- [ ] バックアップファイルがダウンロードされる
- [ ] バックアップファイル名に日時が含まれる

### 7.2 バックアップリストア

- [ ] リストアボタンが表示される
- [ ] バックアップファイルを選択できる
- [ ] リストアが実行される
- [ ] データが正しく復元される
- [ ] リストア後の確認メッセージが表示される

**リストアテスト手順:**

1. 現在のデータベースをバックアップ
2. テストデータを追加・変更
3. 手順 1 のバックアップをリストア
4. データが元に戻っているか確認

---

## 8. UI/UX テスト 🎨

### 8.1 レスポンシブデザイン

- [ ] デスクトップ表示が正しい（1920x1080）
- [ ] ラップトップ表示が正しい（1366x768）
- [ ] タブレット表示が正しい（768x1024）
- [ ] スマートフォン表示が正しい（375x667）

### 8.2 ダークモード

- [ ] ダークモードが適用される
- [ ] ダークモードでも読みやすい
- [ ] ダークモードの切り替えができる

### 8.3 サイドバー

- [ ] サイドバーが開閉できる
- [ ] サイドバーの幅が適切
- [ ] フォルダツリーが表示される
- [ ] アクティブなフォルダがハイライトされる

---

## 9. パフォーマンステスト ⚡

### 9.1 ページ読み込み速度

- [ ] トップページが 3 秒以内に読み込まれる
- [ ] テスト一覧が 3 秒以内に読み込まれる
- [ ] PDF プレビューが 5 秒以内に表示される

### 9.2 大量データ処理

- [ ] 100 件以上のテストでも快適に動作する
- [ ] 大きな PDF ファイル（10MB 以上）でも表示できる
- [ ] 多数のタグがあっても快適に選択できる

---

## 10. セキュリティテスト 🔒

### 10.1 入力検証

- [ ] XSS 攻撃への対策がされている（<script>タグなど）
- [ ] SQL injection への対策がされている
- [ ] ファイルアップロードの拡張子チェックが機能する

### 10.2 エラーハンドリング

- [ ] エラーメッセージに機密情報が含まれない
- [ ] 404 エラーページが表示される
- [ ] 500 エラーページが表示される

---

## 11. ブラウザ互換性テスト 🌐

### 11.1 対応ブラウザ

- [ ] Google Chrome（最新版）
- [ ] Microsoft Edge（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版 - Mac/iOS のみ）

### 11.2 機能動作確認（各ブラウザ）

- [ ] PDF 表示が正常
- [ ] ドラッグ&ドロップが正常
- [ ] ファイルアップロードが正常
- [ ] 印刷機能が正常

---

## 12. エッジケーステスト 🔍

### 12.1 空データ

- [ ] テストが 0 件の場合の表示
- [ ] フォルダが空の場合の表示
- [ ] タグが 0 件の場合の表示

### 12.2 制限値

- [ ] 最大文字数のテスト名
- [ ] 最大ファイルサイズの PDF
- [ ] 最大数のタグ選択
- [ ] 最大数のフォルダ選択

### 12.3 同時操作

- [ ] 複数タブで同時に操作しても問題ない
- [ ] 複数ユーザーが同時にアクセスしても問題ない
- [ ] フォルダ並び替え中の他の操作

---

## 13. データ整合性テスト 🗄️

### 13.1 外部キー制約

- [ ] 存在しないフォルダ ID でテストを作成できない
- [ ] テスト削除時に添付ファイルも削除される
- [ ] フォルダ削除時にテストが未分類に移動する

### 13.2 トランザクション

- [ ] フォルダ順序更新がトランザクションで処理される
- [ ] エラー時にロールバックされる

---

## 14. ログ・デバッグテスト 📊

### 14.1 サーバーログ

- [ ] API リクエストがログに記録される
- [ ] エラーがログに記録される
- [ ] レスポンスタイムがログに記録される

### 14.2 開発者ツール

- [ ] コンソールエラーがない
- [ ] ネットワークエラーがない
- [ ] 不要な warning がない

---

## 15. PM2 本番環境テスト 🚀

### 15.1 PM2 起動

- [ ] `pm2 start ecosystem.config.js` で起動できる
- [ ] プロセスが正常に動作している
- [ ] `pm2 list` でステータスが確認できる

### 15.2 PM2 自動起動

- [ ] `pm2 save` で現在の状態を保存できる
- [ ] `pm2 startup` で Windows サービス登録できる
- [ ] PC 再起動後も自動起動する

### 15.3 PM2 監視

- [ ] `pm2 monit` でリアルタイム監視ができる
- [ ] `pm2 logs` でログが確認できる
- [ ] エラー発生時に自動再起動される

---

## テスト結果サマリー

### 統計

- 総テスト項目数: **\_\_\_** 項目
- 成功: **\_\_\_** 項目
- 失敗: **\_\_\_** 項目
- スキップ: **\_\_\_** 項目
- 成功率: **\_\_\_** %

### クリティカルな問題

1. ***
2. ***
3. ***

### マイナーな問題

1. ***
2. ***
3. ***

### 改善提案

1. ***
2. ***
3. ***

---

## 次のステップ

### 優先度高

- [ ] ***
- [ ] ***

### 優先度中

- [ ] ***
- [ ] ***

### 優先度低

- [ ] ***
- [ ] ***

---

**備考:**

- このチェックリストは定期的に更新してください
- 新機能追加時にはテスト項目も追加してください
- 失敗したテストは原因を特定し、修正後に再テストしてください
